import{login,ModalWindow,menu,serverURL}from"./utils.min.js";const api={footer:'\n        <a class="item" href="https://github.com/owlracle" target="_blank"><i class="fa-brands fa-github"></i></a>\n        <a class="item" href="https://discord.gg/zYS4f8eRbC" target="_blank"><i class="fa-brands fa-discord"></i></a>\n        <a class="item" href="https://t.me/owlracle" target="_blank"><i class="fa-brands fa-telegram"></i></a>\n        <a class="item" href="https://twitter.com/owlracleapi" target="_blank"><i class="fa-brands fa-twitter"></i></a>\n        <a class="item" href="https://medium.com/@owlracleapi" target="_blank"><i class="fa-brands fa-medium"></i></a>\n    ',check:function(){const lg=login.get("logged");return lg?(this.showInfo(),!0):(this.showWelcome(),!1)},showWelcome:function(){const container=document.querySelector("#content #key.item");container.innerHTML=`\n            <div id="content">\n                <h1>Welcome to <span id="site-name">Owlracle</span>!</h1>\n                <h2>The Multichain Gas Price Tracker</h2>\n                <a href="https://owlracle.info" target="_blank"><img id="logo" src="https://owlracle.info/img/owl.webp"></a>\n                <button id="new">Create New Api Key</button>\n                <button id="login">Login with Existing Api Key</button>\n                <button id="guest">Continue as Guest</button>\n            </div>\n            <div id="footer">${this.footer}</div>\n        `,menu.hide(),container.querySelector("#guest").addEventListener("click",()=>{new ModalWindow({title:"Warning",message:"Guest users have a much lower request limit. Are you sure you want to go without an api key?",buttons:{YES:()=>{menu.show().click("gas"),login.set({logged:!0})},NO:()=>{}}})}),container.querySelector("#login").addEventListener("click",()=>{this.showInfo()}),container.querySelector("#new").addEventListener("click",()=>{this.newApiKey()})},showInfo:async function(){const apiKey=login.get("apikey");if(!apiKey)return void this.showGuestInfo();const container=document.querySelector("#content #key");container.querySelector("#content")&&container.querySelector("#content").classList.contains("key-info")||(container.innerHTML='<i class="fas fa-spin fa-cog"></i>',container.classList.add("loading"));const data=await(await fetch(`${serverURL}/keys/${apiKey}`)).json();if(data.error)return new ModalWindow({title:"Session expired",message:"Your session has expired. Please log in again with your api key."}),login.delete(["apikey","logged"]),void menu.click("key");container.classList.remove("loading"),container.innerHTML=`\n            <div id="content" class="logged key-info">\n                <div class="row">\n                    <span>Api Key</span>\n                    <span>Credit</span>\n                </div>\n                <div class="row">\n                    <input class="input" value="${data.apiKey.slice(0,4)}...${data.apiKey.slice(-4)}" readonly>\n                    <input class="input" value="$${parseFloat(data.credit).toFixed(4)}" readonly>\n                </div>\n                <div class="row">\n                    <span>Usage 1h</span>\n                    <span>Usage Total</span>\n                </div>\n                <div class="row">\n                    <input class="input" value="${data.usage.apiKeyHour}" readonly>\n                    <input class="input" value="${data.usage.apiKeyTotal}" readonly>\n                </div>\n                <button id="logout"><i class="fa-solid fa-right-from-bracket"></i>LOGOUT</button>\n                <a href="${serverURL}/?action=keys&apikey=${data.apiKey}" target="_blank">Visit owlracle.info for more information</a>\n            </div>\n            <div id="footer" class="logged">${this.footer}</div>\n        `,container.querySelector("#logout").addEventListener("click",()=>{login.delete(["apikey","logged"]),menu.click("key")})},showGuestInfo:function(){const logged=login.get("logged"),container=document.querySelector("#content #key");container.innerHTML=`<div id="content" class="logged">\n            <span>${logged?"Log in with an api key to increase your request limit":"Log in using your api key"}</span>\n            <input class="input" placeholder="YOUR_API_KEY">\n            <span id="tip"></span>\n            <label><input type="checkbox" class="checkbox">Remember api key</label>\n            <button id="login"><i class="fa-solid fa-right-to-bracket"></i>LOG IN</button>\n            ${logged?'\n                <span class="small">or</span>\n                <a>Create New Api Key</a>\n            ':'\n                <button id="back"><i class="fa-solid fa-arrow-left"></i>BACK</button>\n            '}\n        </div>`;const input=container.querySelector(".input"),checkbox=container.querySelector(".checkbox"),button=container.querySelector("#login"),linkNew=container.querySelector("a"),regex=new RegExp(/^[a-f0-9]{32}$/);input.focus(),input.addEventListener("input",()=>{input.value.match(regex)&&this.hideTip()}),input.addEventListener("keypress",e=>{"Enter"==e.key&&button.click()}),button.addEventListener("click",async()=>{if(!input.value.match(regex))return void this.showTip("Invalid api key format");const text=button.innerHTML;button.innerHTML='<i class="fas fa-spin fa-cog"></i>';const data=await(await fetch(`${serverURL}/keys/${input.value.toLowerCase()}`)).json();if(button.innerHTML=text,data.error&&401==data.status)return void this.showTip("Could not find your api key");const opt={logged:!0,apikey:data.apiKey};checkbox.checked?opt.persist=!0:login.get("persist")&&login.delete("persist"),login.set(opt),menu.show().click("gas")}),logged?linkNew.addEventListener("click",async()=>{this.newApiKey()}):container.querySelector("#back").addEventListener("click",async()=>menu.click("key"))},showTip:function(message){const container=document.querySelector("#content #key"),input=container.querySelector("input"),tip=container.querySelector("#tip");input.classList.add("red"),tip.classList.add("show"),tip.innerHTML=message,input.focus()},hideTip:function(){const container=document.querySelector("#content #key"),input=container.querySelector("input"),tip=container.querySelector("#tip");input.classList.remove("red"),tip.classList.remove("show")},newApiKey:function(){window.open(`${serverURL}/?action=newkey`)}};export default api;
//# sourceMappingURL=api.min.js.map