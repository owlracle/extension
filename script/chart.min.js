import{network,cookies,login,imgCache,Dropdown,ModalWindow,menu}from"./utils.min.js";export default{ready:!1,timeframe:60,page:1,candles:1e3,lastCandle:((new Date).getTime()/1e3).toFixed(0),allRead:!1,network:network.get().symbol,config:{area:{style:"area",color:"#2962ff"},candlestick:{style:"candlestick",colorUp:"#4CA69A",colorDown:"#E0544E"}},preferences:{gas:"area",token:"candlestick",fee:"area"},init:async function(){if(document.querySelector("#content #chart.item").innerHTML='\n                <div class="row">\n                    <div id="timeframe-switcher"><button></button></div>\n                    <div id="style-switcher"><button><img></button></div>\n                </div>\n                <div id="chart"><i class="fas fa-spin fa-cog"></i></div>\n                <div id="toggle-container">\n                    <button id="gas"><span class="mark"></span>Gas</button>\n                    <button id="token"><span class="mark"></span>Token</button>\n                    <button id="fee"><span class="mark"></span>Fee</button>\n                </div>\n            </div>',this.obj=LightweightCharts.createChart(document.querySelector("#content #chart.item #chart"),{width:document.querySelector("#content").offsetWidth,height:350,crosshair:{mode:LightweightCharts.CrosshairMode.Normal},timeScale:{timeVisible:!0,secondsVisible:!1}}),cookies.get("chart")){let chartCookie=null;try{chartCookie=cookies.get("chart",!0)}catch(error){console.log(error),cookies.delete("chart")}chartCookie.gas&&(this.preferences.gas=chartCookie.gas),chartCookie.token&&(this.preferences.token=chartCookie.token),chartCookie.fee&&(this.preferences.fee=chartCookie.fee),chartCookie.timeframe&&(this.timeframe=chartCookie.timeframe)}this.series={gas:{config:Object.assign({},this.config[this.preferences.gas])},token:{config:Object.assign({},this.config[this.preferences.token])},fee:{config:Object.assign({},this.config[this.preferences.fee])}},document.querySelectorAll("#content #chart.item #toggle-container button").forEach(e=>e.addEventListener("click",()=>this.setMode(e.id))),this.setMode("gas");const container=document.querySelector("#chart.item #chart"),toolTip=document.createElement("div");toolTip.id="tooltip-chart",container.appendChild(toolTip),this.obj.subscribeCrosshairMove(param=>{if(void 0===param.point||!param.time||param.point.x<0||param.point.x>container.clientWidth||param.point.y<0||param.point.y>container.clientHeight)toolTip.style.display="none";else{toolTip.style.display="block";const visibleSerie=Object.keys(this.series).filter(e=>this.series[e].visible)[0],price=param.seriesPrices.get(this.series[visibleSerie].series);if(price&&"number"!=typeof price){toolTip.innerHTML=Object.entries(price).map(([key,value])=>{const name=key.charAt(0).toUpperCase()+key.slice(1);return value.toString().split(".").length>=2&&value.toString().split(".")[1].length>4&&(value=(value=value.toString().split("."))[0]+"."+value[1].slice(0,4)),`<div class="${key}"><span class="name">${name}</span>: ${value}</div>`}).join("");const coordinateY=container.offsetTop+10,coordinateX=container.offsetLeft+10;toolTip.style.left=`${coordinateX}px`,toolTip.style.top=`${coordinateY}px`}else toolTip.style.display="none"}}),new Dropdown({button:document.querySelector("#content #chart.item #timeframe-switcher button"),itemList:[{id:"tf-10",innerHTML:`<img class="icon" src="${imgCache["time-10"].src}">10 minutes`},{id:"tf-30",innerHTML:`<img class="icon" src="${imgCache["time-30"].src}">30 minutes`},{id:"tf-60",innerHTML:`<img class="icon" src="${imgCache["time-60"].src}">1 hour`},{id:"tf-120",innerHTML:`<img class="icon" src="${imgCache["time-120"].src}">2 hours`},{id:"tf-240",innerHTML:`<img class="icon" src="${imgCache["time-240"].src}">4 hours`},{id:"tf-1440",innerHTML:`<img class="icon" src="${imgCache["time-1440"].src}">1 day`}],clickFn:b=>this.timeframeSwitch(b.id.split("tf-")[1])}),this.timeScale=this.obj.timeScale(),this.timeScale.subscribeVisibleLogicalRangeChange(async()=>{const logicalRange=this.timeScale.getVisibleLogicalRange();if(null!==logicalRange&&logicalRange.from<0&&this.history.length>=this.candles&&!this.scrolling&&!this.allRead){this.scrolling=!0;const oldHistory=this.history,newHistory=await this.getHistory(this.timeframe,this.page+1);this.history=[...oldHistory,...newHistory],this.update(this.history),this.page++,this.scrolling=!1,0==newHistory.length&&(this.allRead=!0)}}),new Dropdown({button:document.querySelector("#content #chart.item #style-switcher button"),itemList:[{id:"style-area",innerHTML:`<img class="icon" src="${imgCache["line-chart"].src}">Area`},{id:"style-candlestick",innerHTML:`<img class="icon" src="${imgCache["candle-chart"].src}">Candlestick`}],clickFn:async b=>{if(this.queryHistory)return;const styleswitcher=document.querySelector("#content #chart.item #style-switcher button");styleswitcher.innerHTML='<i class="fas fa-spin fa-cog"></i>';const serie=this.series[this.mode],style=this.preferences[this.mode]=b.id.split("style-")[1];serie.config=Object.assign({},this.config[style]),this.queryHistory=!0;const history=await this.getHistory(this.timeframe);this.obj.removeSeries(serie.series),serie.series=null,this.update(history),serie.series.applyOptions({visible:serie.visible}),styleswitcher.innerHTML=`<img src="${imgCache[`${"candlestick"==this.preferences[this.mode]?"candle":"line"}-chart`].src}">${this.preferences[this.mode][0].toUpperCase()+this.preferences[this.mode].slice(1)}`,this.setCookie(),this.queryHistory=!1}}),this.setTheme("dark"),document.querySelector("#content #chart.item #chart i").remove(),this.ready=!0},setMode:function(mode){this.mode==mode||this.queryHistory||document.querySelectorAll("#content #chart.item #toggle-container button").forEach(a=>{const series=this.series[a.id];a.id==mode?(a.classList.add("active"),series.visible=!0,this.mode=a.id,document.querySelector("#content #chart.item #style-switcher button").innerHTML=`<img src="${imgCache[`${"candlestick"==this.preferences[this.mode]?"candle":"line"}-chart`].src}">${this.preferences[this.mode][0].toUpperCase()+this.preferences[this.mode].slice(1)}`):(a.classList.remove("active"),series.visible=!1),series.series&&series.series.applyOptions({visible:series.visible})})},timeframeSwitch:async function(time){if(this.ready||await this.init(),this.queryHistory)return;time?this.timeframe=time:time=this.timeframe;const tfswitcher=document.querySelector("#content #chart.item #timeframe-switcher button");tfswitcher.innerHTML='<i class="fas fa-spin fa-cog"></i>',this.queryHistory=!0;const history=await this.getHistory(time),text=(time=>({10:"10 minutes",30:"30 minutes",60:"1 hour",120:"2 hours",240:"4 hours",1440:"1 day"}[time]))(time);tfswitcher.innerHTML=`<img src="${imgCache[`time-${time}`].src}">${text}`,this.update(history),this.setCookie(),this.queryHistory=!1,document.querySelectorAll("#toggle-container button").forEach(b=>{const series=this.series[b.id];series.visible&&series.series.applyOptions({visible:series.visible})})},setCookie:function(){const cookieChart=Object.fromEntries(Object.entries(this.series).map(([k,v])=>[k,v.config.style]));cookieChart.timeframe=this.timeframe,cookies.set("chart",cookieChart,{json:!0})},update:function(data){if(data.length){const seriesName={gas:"gasPrice",token:"tokenPrice",fee:"txFee"};Object.entries(this.series).forEach(([key,value])=>{const speedData=data.map(e=>"candlestick"==value.config.style?{open:e[seriesName[key]].open,close:e[seriesName[key]].close,low:e[seriesName[key]].low,high:e[seriesName[key]].high,time:parseInt(new Date(e.timestamp).getTime()/1e3)}:{value:(e[seriesName[key]].close+e[seriesName[key]].open)/2,time:parseInt(new Date(e.timestamp).getTime()/1e3)}).reverse();value.series||("candlestick"==value.config.style?value.series=this.obj.addCandlestickSeries({upColor:value.config.colorUp,downColor:value.config.colorDown,borderDownColor:value.config.colorDown,borderUpColor:value.config.colorUp,wickDownColor:value.config.colorDOwn,wickUpColor:value.config.colorUp,visible:!1}):value.series=this.obj.addAreaSeries({lineColor:value.config.color,topColor:`${value.config.color}80`,bottomColor:`${value.config.color}10`,lineWidth:2,visible:!1})),value.series.setData(speedData)})}},setTheme:function(name){let background="#232323",text="#e3dcd0",lines="#3c3c3c";"light"==name&&(background="#eeeeee",text="#511814",lines="#c9c9c9"),this.isReady().then(()=>{this.obj.applyOptions({layout:{backgroundColor:background,textColor:text},grid:{vertLines:{color:lines},horzLines:{color:lines}},rightPriceScale:{borderColor:lines},timeScale:{borderColor:lines}})})},getHistory:async function(timeframe=60,page=1,candles=this.candles){this.network=network.get().symbol,this.timeframe=timeframe;let query={timeframe:timeframe,page:page,candles:candles,to:this.lastCandle,tokenprice:!0,txfee:!0};return login.get("apikey")&&(query.apikey=login.get("apikey")),query=new URLSearchParams(query).toString(),this.history=await(await fetch(`https://owlracle.info/${this.network}/history?${query}`)).json(),this.history.error?(new ModalWindow({title:this.history.error,message:this.history.message,buttons:{LOGIN:()=>menu.click("key"),CLOSE:()=>{}}}),console.log(this.history),401==this.history.error.status?this.getHistory(timeframe,page,candles):[]):this.history},isReady:async function(){return this.ready||new Promise(resolve=>setTimeout(()=>resolve(this.isReady()),10))}};
//# sourceMappingURL=chart.min.js.map