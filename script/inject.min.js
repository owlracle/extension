const messageBus={events:{},watchDomMessage:async function(id){return new Promise(resolve=>{const checkInt=setInterval(()=>{const extMessageContainer=document.querySelector("#"+id);if(extMessageContainer){const extMessage=JSON.parse(extMessageContainer.value);extMessageContainer.remove(),clearInterval(checkInt),resolve(extMessage)}},100)})},watch:async function(){const message=await this.watchDomMessage("extension-message-received");let replyMsg="Message received, but no reply given";message.event&&this.events[message.event]&&(replyMsg=await this.events[message.event](message)),this.writeDomMessage("extension-message-received-reply",replyMsg),setTimeout(()=>this.watch(),100)},addEvent:function(name,callback){this.events[name]=callback},writeDomMessage:function(id,message){const el=document.createElement("input");el.id=id,el.type="hidden",el.value=JSON.stringify(message),document.body.insertAdjacentElement("beforeend",el)},send:async function(event,message,reply){this.writeDomMessage("extension-message-sent",{event:event,message:message});const response=await this.watchDomMessage("extension-message-sent-reply");reply(response)}};messageBus.watch();const owlracle={url:"https://owlracle.info",speed:0,args:{accept:"75"},getNetwork:function(){const networks=[{name:"eth",id:1},{name:"bsc",id:56},{name:"poly",id:137},{name:"ftm",id:250},{name:"avax",id:43114},{name:"cro",id:25},{name:"movr",id:1285},{name:"one",id:16666e4},{name:"ht",id:128},{name:"celo",id:42220},{name:"fuse",id:122}];return this.network=networks.find(e=>e.id==parseInt(window.ethereum.networkVersion)).name,this.network},lastGas:{expire:1e4,get:async function(){await new Promise(resolve=>{const check=()=>{this.locked||resolve(!0),setTimeout(()=>check(),100)};check()});const now=(new Date).getTime();return this.value&&now-this.time<this.expire?this.value:(this.locked=!0,!1)},set:function(value){this.value=value,this.time=(new Date).getTime(),this.locked=!1}},getGas:async function(){if(!this.apiKey)return console.log("No Owlracle API key provided"),!1;let gasPrice=await this.lastGas.get();if(gasPrice)return gasPrice;const args=this.args?"&"+new URLSearchParams(this.args).toString():"",url=`${this.url}/${this.getNetwork()}/gas?apikey=${this.apiKey}${args}`;this.verbose&&console.log(`Requesting ${url}`);const req=await fetch(url),res=await req.json();return res.speeds[this.speed]&&res.speeds[this.speed].gasPrice&&(gasPrice=res.speeds[this.speed].gasPrice,this.lastGas.set(gasPrice)),gasPrice}};if(window.ethereum){const requestOverride=ethereum=>{const oldReq=ethereum.request;ethereum.request=async({method:method,params:params})=>{if("eth_sendTransaction"==method&&params&&params[0]){const gasPrice=await owlracle.getGas();gasPrice&&(params[0].gasPrice="0x"+parseInt(1e9*gasPrice).toString(16),console.log(`游불 Owlracle suggests: ${gasPrice} GWei`))}return oldReq({method:method,params:params})}};requestOverride(window.ethereum),messageBus.addEvent("advisor",message=>(!owlracle.apiKey&&message.apiKey&&(console.log("游불 You are taking Owlracle's advice for gas price settings on your Metamask transactions 游불"),console.log("游불 Check our website https://owlracle.info or get in touch at https://t.me/owlracle 游불")),owlracle.apiKey=message.apiKey,!0))}else console.log("Metamask not detected");
//# sourceMappingURL=inject.min.js.map