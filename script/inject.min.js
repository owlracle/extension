const messageBus={events:{},watchDomMessage:async function(id){return new Promise(resolve=>{const checkInt=setInterval(()=>{const extMessageContainer=document.querySelector("#"+id);if(extMessageContainer){const extMessage="undefined"!==extMessageContainer.value&&JSON.parse(extMessageContainer.value);extMessageContainer.remove(),clearInterval(checkInt),resolve(extMessage)}},100)})},watch:async function(){const message=await this.watchDomMessage("extension-message-received");let replyMsg="Message received, but no reply given";message.event&&this.events[message.event]&&(replyMsg=await this.events[message.event](message)),this.writeDomMessage("extension-message-received-reply",replyMsg),setTimeout(()=>this.watch(),100)},addEvent:function(name,callback){this.events[name]=callback},writeDomMessage:function(id,message){const el=document.createElement("input");el.id=id,el.type="hidden",el.value=JSON.stringify(message),document.body.insertAdjacentElement("beforeend",el)},send:async function(event,message,reply){this.writeDomMessage("extension-message-sent",{event:event,message:message});const response=await this.watchDomMessage("extension-message-sent-reply");reply&&reply(response)}};messageBus.watch();const network={list:[{name:"eth",id:1},{name:"bsc",id:56},{name:"poly",id:137},{name:"ftm",id:250},{name:"avax",id:43114},{name:"cro",id:25},{name:"movr",id:1285},{name:"one",id:16666e4},{name:"ht",id:128},{name:"celo",id:42220},{name:"fuse",id:122}],get:function(){return this.selected=this.list.find(e=>e.id==parseInt(window.ethereum.networkVersion)),this.selected},onChange:function(callback){this.changeCallback=callback},changeWatcher:function(){setInterval(()=>{const oldNetwork=this.selected;this.get(),oldNetwork!=this.selected&&(this.changeCallback&&this.changeCallback(this.selected),oldNetwork&&messageBus.send("network",{network:this.selected.name}))},100)}};network.changeWatcher();const owlracle={url:"https://owlracle.info",speed:0,args:{accept:"75",source:"advisor"},lastGas:{expire:1e4,get:async function(){await new Promise(resolve=>{const check=()=>{this.locked||resolve(!0),setTimeout(()=>check(),100)};check()});const now=(new Date).getTime();return this.value&&now-this.time<this.expire?this.value:(this.locked=!0,!1)},set:function(value){this.value=value,this.time=(new Date).getTime(),this.locked=!1}},getGas:async function(){if(!this.apiKey)return console.log("No Owlracle API key provided"),!1;let gasPrice=await this.lastGas.get();if(gasPrice)return gasPrice;const ntw=network.get();if(!ntw)return console.log("Network not supported"),!1;this.args.apikey=this.apiKey;const url=`${this.url}/${ntw.name}/gas?${new URLSearchParams(this.args).toString()}`,req=await fetch(url),res=await req.json(),speedInfo=res.speeds[this.speed];return speedInfo&&speedInfo.gasPrice&&(gasPrice=res.baseFee?{maxFeePerGas:speedInfo.gasPrice,maxPriorityFeePerGas:speedInfo.gasPrice-res.baseFee}:{gasPrice:speedInfo.gasPrice},this.lastGas.set(gasPrice)),gasPrice}};if(window.ethereum){const requestOverride=ethereum=>{const oldReq=ethereum.request;ethereum.request=async({method:method,params:params})=>{let change=!1;if("eth_sendTransaction"==method&&params&&params[0]&&(change=!0),change){const gasPrice=await owlracle.getGas();gasPrice.gasPrice?(console.log(`游불 Owlracle suggests: ${gasPrice.gasPrice} GWei`),params[0].gasPrice="0x"+parseInt(1e9*gasPrice.gasPrice).toString(16),delete params[0].maxFeePerGas,delete params[0].maxPriorityFeePerGas):gasPrice.maxFeePerGas&&(console.log("游불 Owlracle suggests:"),Object.entries(gasPrice).forEach(([k,v])=>{params[0][k]="0x"+parseInt(1e9*v).toString(16),console.log(`${k}: ${v} GWei`)}),delete params[0].gasPrice)}const res=oldReq({method:method,params:params});return change&&res.then(hash=>{}),res}};requestOverride(window.ethereum),messageBus.addEvent("advisor",message=>(!owlracle.apiKey&&message.apiKey&&(console.log("游불 You are taking Owlracle's advice for gas price settings on your Metamask transactions 游불"),console.log("游불 Check our website https://owlracle.info or get in touch at https://t.me/owlracle 游불")),owlracle.apiKey=message.apiKey,!0)),messageBus.addEvent("get-network",()=>network.get().name)}else console.log("Metamask not detected");
//# sourceMappingURL=inject.min.js.map